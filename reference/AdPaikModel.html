<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Adapted Paik et Al.'s Model: Time-Dependent Shared Frailty Cox Model — AdPaikModel • TimeDepFrail</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Adapted Paik et Al.'s Model: Time-Dependent Shared Frailty Cox Model — AdPaikModel"><meta name="description" content="Function for applying the 'Adapted Paik et al.'s Model', a Cox Model with time-dependent frailty,
shared by individuals belonging to the same group/cluster.
To generate time-dependence, the temporal domain is divided into a certain number
of intervals. The model log-likelihood function depends on a certain number of parameters and
is maximized with respect to all of them,
using a reinterpretation of the 'Powell's method in multidimension',
that is a multi-dimensional optimization method based on
repeated one-dimensional optimization of the log-likelihood function (with respect to one parameter at the time).
In this context, the one-dimensional optimization is performed through the 'optimize' R function.
For more information about the unknown model parameters, their type and numerosity refer to Details.
Several quantities are estimated at the end of the optimization phase, such as
optimal parameters, baseline hazard, frailty dispersion (standard deviation and variance),
posterior frailty estimates, with their variance and confidence interval,
conditional survival function, Akaike Information Criterion (AIC), ..."><meta property="og:description" content="Function for applying the 'Adapted Paik et al.'s Model', a Cox Model with time-dependent frailty,
shared by individuals belonging to the same group/cluster.
To generate time-dependence, the temporal domain is divided into a certain number
of intervals. The model log-likelihood function depends on a certain number of parameters and
is maximized with respect to all of them,
using a reinterpretation of the 'Powell's method in multidimension',
that is a multi-dimensional optimization method based on
repeated one-dimensional optimization of the log-likelihood function (with respect to one parameter at the time).
In this context, the one-dimensional optimization is performed through the 'optimize' R function.
For more information about the unknown model parameters, their type and numerosity refer to Details.
Several quantities are estimated at the end of the optimization phase, such as
optimal parameters, baseline hazard, frailty dispersion (standard deviation and variance),
posterior frailty estimates, with their variance and confidence interval,
conditional survival function, Akaike Information Criterion (AIC), ..."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">TimeDepFrail</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Adapted Paik et Al.'s Model: Time-Dependent Shared Frailty Cox Model</h1>

      <div class="d-none name"><code>AdPaikModel.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Function for applying the 'Adapted Paik et al.'s Model', a Cox Model with time-dependent frailty,
shared by individuals belonging to the same group/cluster.</p>
<p>To generate time-dependence, the temporal domain is divided into a certain number
of intervals. The model log-likelihood function depends on a certain number of parameters and
is maximized with respect to all of them,
using a reinterpretation of the 'Powell's method in multidimension',
that is a multi-dimensional optimization method based on
repeated one-dimensional optimization of the log-likelihood function (with respect to one parameter at the time).
In this context, the one-dimensional optimization is performed through the 'optimize' R function.
For more information about the unknown model parameters, their type and numerosity refer to Details.</p>
<p>Several quantities are estimated at the end of the optimization phase, such as
optimal parameters, baseline hazard, frailty dispersion (standard deviation and variance),
posterior frailty estimates, with their variance and confidence interval,
conditional survival function, Akaike Information Criterion (AIC), ...</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">AdPaikModel</span><span class="op">(</span></span>
<span>  <span class="va">formula</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">time_axis</span>,</span>
<span>  <span class="va">categories_range_min</span>,</span>
<span>  <span class="va">categories_range_max</span>,</span>
<span>  n_extrarun <span class="op">=</span> <span class="fl">60</span>,</span>
<span>  tol_ll <span class="op">=</span> <span class="fl">1e-06</span>,</span>
<span>  tol_optimize <span class="op">=</span> <span class="fl">1e-06</span>,</span>
<span>  h_dd <span class="op">=</span> <span class="fl">0.001</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  print_previous_ll_values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-formula">formula<a class="anchor" aria-label="anchor" href="#arg-formula"></a></dt>
<dd><p>Formula object having on the left hand side the time-to-event variable, that is the time-instant in which
the individual failed. On the right hand side, it has the regressors and the cluster variable.</p></dd>


<dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>Dataset in which all variables of the formula object must be found and contained.
This dataset can also contain other variables, but they will not be considered.
It can be either a dataframe or a matrix, but in both cases the name of each column must correspond to the name of
the formula variables. It is not necessary to attach it (in case of a data.frame)</p></dd>


<dt id="arg-time-axis">time_axis<a class="anchor" aria-label="anchor" href="#arg-time-axis"></a></dt>
<dd><p>Temporal domain</p></dd>


<dt id="arg-categories-range-min">categories_range_min<a class="anchor" aria-label="anchor" href="#arg-categories-range-min"></a></dt>
<dd><p>Vector containing the minimum value assumable by each parameter category.</p></dd>


<dt id="arg-categories-range-max">categories_range_max<a class="anchor" aria-label="anchor" href="#arg-categories-range-max"></a></dt>
<dd><p>Vector containing the maximum value assumable by each parameter category.</p></dd>


<dt id="arg-n-extrarun">n_extrarun<a class="anchor" aria-label="anchor" href="#arg-n-extrarun"></a></dt>
<dd><p>Total number of runs (iterations) are obtained summing to the number of parameters and n_extrarun.</p></dd>


<dt id="arg-tol-ll">tol_ll<a class="anchor" aria-label="anchor" href="#arg-tol-ll"></a></dt>
<dd><p>Tolerance on the log-likelihood value.</p></dd>


<dt id="arg-tol-optimize">tol_optimize<a class="anchor" aria-label="anchor" href="#arg-tol-optimize"></a></dt>
<dd><p>Internal tolerance for the one-dimensional optimization through 'optimize' R function.</p></dd>


<dt id="arg-h-dd">h_dd<a class="anchor" aria-label="anchor" href="#arg-h-dd"></a></dt>
<dd><p>Discretization step used for the numerical approximation of the second derivative of the log-likelihood function.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Logical. If <code>TRUE</code>, detailed progress messages will be printed to the console. Defaults to <code>FALSE</code>.</p></dd>


<dt id="arg-print-previous-ll-values">print_previous_ll_values<a class="anchor" aria-label="anchor" href="#arg-print-previous-ll-values"></a></dt>
<dd><p>If we want to print the previous values of the log-likelihood function. This can
be useful for controlling that the optimization procedure is proceeding in a monotone way and it does not
oscillate.
This argument is composed of two elements: TRUE/FALSE if we want or not to print the previous values and how many values we
want to print on the console. Default is (TRUE, 3), so that only the previous 3 values of the log-likelihood are printed.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>S3 object of class 'AdPaik', composed of several elements. See Details.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Two observation needs to made about the time-domain:</p><ul><li><p>The time domain may coincide with the follow-up or it may be contained in it.
Indeed, the left boundary can be greater than the beginning of the follow-up and, for instance, it can coincide
with the time-instants in which the events begin to happen; conversely, the right boundary of the two must be the same.</p></li>
<li><p>The partition of the time domain into intervals can be made according to two selected criteria:
(1) using an already existent partition of the follow-up
(2) using the shape of the baseline hazard function for a time independent model as reference: divide the time-domain according to regions in
which it has a peak or a plateau.</p></li>
</ul><p>The parameters with respect to which the log-likelihood function must be optimized are:</p><ul><li><p>baseline log-hazard (number of parameters = number of intervals of the time-domain)</p></li>
<li><p>data regressors</p></li>
<li><p>\(\mu_1\), \(\nu\): parameters of the gamma distribution of \(\alpha_j\) (time-independent/constant) (2 parameters)</p></li>
<li><p>\(\gamma_k\): parameters of the gamma distribution of \(\epsilon_{jk}\) (time-dependent) (number of parameters = number of intervals)
Another model parameter is \(\mu_2\) and it is get imposing the constraint that \(\mu_1 + \mu_2 = 1\).
As it can be notice, some parameters can be grouped into the same category (regressors, baseline log-hazard and so on)
and we can easily constraint them assigning each category both a minimum and maximum range.
The vector is structured as follows: (baseline log-hazard, regressors, \(\mu_1\), \(\nu\), \(\gamma_k\)) with dimension
(n_intervals, n_regressors, 1, 1, n_intervals).</p></li>
</ul><p>The output of the model call 'AdPaikModel(...)' is a S3 object of class 'AdPaik', composed of the following quantities:</p><ul><li><p>formula: formula object provided in input by the user and specifying the relationship between the time-to-event, the covariates of
the dataset (regressors) and the cluster variable.</p></li>
<li><p>dataset: matrix of the dataset containing the regressors and the dummy variables of the categorical covariates.</p></li>
<li><p>Regressors: categorical vector of length R, with the name of the regressors.
They could be different from the original covariates of the dataset in case of categorical covariates.
Indeed, each categorical covariate with n levels needs to be transformed into (n-1) dummy variables and, therefore, (n-1) new regressors.</p></li>
<li><p>NRegressors: number of regressors (R)</p></li>
<li><p>ClusterVariable: name of the variable with respect to which the individuals can be grouped.</p></li>
<li><p>NClusters: number of clusters/centres (also indicated with N).</p></li>
<li><p>ClusterCodes: vector of length equal to the number of clusters, containing the codes of the clusters.</p></li>
<li><p>TimeDomain: vector of the time-domain partition.</p></li>
<li><p>NIntervals: number of intervals of the time-domain, also called with L.</p></li>
<li><p>NObservations: number of observations of the dataset.</p></li>
<li><p>NParameters: number of parameters of the model. It can be computed as: \(n_p = 2L + R + 2\).</p></li>
<li><p>ParametersCategories: Numerical vector of length 5, containing the numerosity of each parameter category.</p></li>
<li><p>ParametersRange: S3 object of class 'ParametersRange', containing ParametersRangeMin and ParametersRangeMax, two numerical vectors of length \(n_p\), giving the minimum and the maximum range of each parameter, respectively.</p></li>
<li><p>Loglikelihood: value of the maximized log-likelihood function, at the optimal estimated parameters.</p></li>
<li><p>AIC: 'Akaike Information Criterion': it can be computed as \(AIC = 2n_p - 2ll_{optimal}\).
It quantifies the loss of information related to the model fitting and output.
The smaller, the less the loss of information and the better the model accuracy.</p></li>
<li><p>Status: Logical value. TRUE if the model reaches convergence, FALSE otherwise.</p></li>
<li><p>NRun: Number of runs necessary to reach convergence. If the model does not reach convergence, such number is equal to the maximum number
of imposed runs.</p></li>
<li><p>OptimalParameters: numerical vector of length \(n_p\), containing the optimal estimated parameters (the parameters
that maximize the log-likelihood function).</p></li>
<li><p>StandardErrorParameters: numerical vector of length \(n_p\), corresponding to the standard error of each estimated parameters.</p></li>
<li><p>ParametersCI: S3 object of class 'ParametersCI', composed of two numerical vector of length equal to \(n_p\): the left and right 95\<!-- % confidence -->
interval of each estimated parameter of given level.</p></li>
<li><p>BaselineHazard: numerical vector of length equal to L, containing the baseline hazard step-function.</p></li>
<li><p>FrailtyDispersion:  S3 object of class 'FrailtyDispersion', containing two numerical vectors of length equal to L with the standard deviation and the variance of the frailty.
numerical vector of length equal to L (i.e. number of intervals of the time-domain), reporting the standard deviation
of the frailty.</p></li>
<li><p>PosteriorFrailtyEstimates: S3 object of class 'PFE.AdPaik'. The object of class 'PFE.AdPaik' contains the Posterior Frailty Estimates computed with the procedure indicated in the reference paper and it is composed of three elements:</p><ul><li><p>'alpha': posterior frailty estimates for \(\alpha_j, \forall j\). It is a vector of length equal to the number of centres.</p></li>
<li><p>'eps': posterior frailty estimates for \(\epsilon_{jk}, \forall j,k\). Matrix of dimension (N, L).</p></li>
<li><p>'Z': posterior frailty estimates for \(Z_{jk} = \alpha_j + \epsilon_{jk}, \forall j,k\). Matrix of dimension (N, L).</p></li>
</ul></li>
<li><p>PosteriorFrailtyVariance: S3 object of class 'PFV.AdPaik'. The object of class 'PFV.AdPaik' contains the Posterior Frailty Variances computed as indicated in the reference papaer and it is  composed of three elements:</p><ul><li><p>'alphaVar': posterior frailty variance for \(\alpha_j, \forall j\). It is a vector of length equal to the number of centres.</p></li>
<li><p>'epsVar': posterior frailty variance for \(\epsilon_{jk}, \forall j,k\). Matrix of dimension (N, L).</p></li>
<li><p>'ZVar': posterior frailty variance for \(Z_{jk} = \alpha_j + \epsilon_{jk}, \forall j,k\). Matrix of dimension (N, L).</p></li>
</ul></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Consider the 'Academic Dropout dataset'</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">data_dropout</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Define the variables needed for the model execution</span></span></span>
<span class="r-in"><span><span class="va">formula</span> <span class="op">&lt;-</span> <span class="va">time_to_event</span> <span class="op">~</span> <span class="va">Gender</span> <span class="op">+</span> <span class="va">CFUP</span> <span class="op">+</span> <span class="fu">cluster</span><span class="op">(</span><span class="va">group</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">time_axis</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.0</span>, <span class="fl">1.4</span>, <span class="fl">1.8</span>, <span class="fl">2.3</span>, <span class="fl">3.1</span>, <span class="fl">3.8</span>, <span class="fl">4.3</span>, <span class="fl">5.0</span>, <span class="fl">5.5</span>, <span class="fl">5.8</span>, <span class="fl">6.0</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">eps</span> <span class="op">&lt;-</span> <span class="fl">1e-10</span></span></span>
<span class="r-in"><span><span class="va">categories_range_min</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">8</span>, <span class="op">-</span><span class="fl">2</span>, <span class="va">eps</span>, <span class="va">eps</span>, <span class="va">eps</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">categories_range_max</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="va">eps</span>, <span class="fl">0</span>, <span class="fl">1</span> <span class="op">-</span> <span class="va">eps</span>, <span class="fl">1</span>, <span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="co"># Call the main model</span></span></span>
<span class="r-in"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">AdPaikModel</span><span class="op">(</span><span class="va">formula</span>, <span class="va">data_dropout</span>, <span class="va">time_axis</span>,</span></span>
<span class="r-in"><span>                      <span class="va">categories_range_min</span>, <span class="va">categories_range_max</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in while (r &lt;= n_run &amp; actual_tol_ll &gt; tol_ll) {    if (verbose)         message(paste("Run ", r))    RemainingIndexes &lt;- RunIndexes[r, ]    UsedIndexes &lt;- c()    while (length(RemainingIndexes) != 0) {        index_to_vary &lt;- RemainingIndexes[1]        PosIndex &lt;- which(RemainingIndexes == index_to_vary)        RemainingIndexes &lt;- RemainingIndexes[-PosIndex]        UsedIndexes &lt;- c(UsedIndexes, index_to_vary)        result_optimize &lt;- suppressWarnings(optimize(ll_AdPaik_1D,             c(params_range_min[index_to_vary], params_range_max[index_to_vary]),             maximum = TRUE, tol = tol_optimize, index_to_vary,             params, dataset, centre, time_axis, dropout_matrix,             e_matrix))        params[index_to_vary] &lt;- result_optimize$maximum    }    global_optimal_params[r, ] &lt;- params    global_optimal_loglikelihood_run &lt;- ll_AdPaik_eval(params,         dataset, centre, time_axis, dropout_matrix, e_matrix)    global_optimal_loglikelihood[r] &lt;- global_optimal_loglikelihood_run    if (is.nan(global_optimal_loglikelihood_run))         stop("NaN value for the optimal log-likelihood value.")    if (print_previous_ll_values[1]) {        n_previous &lt;- print_previous_ll_values[2]        if (r &lt; n_previous)             if (verbose)                 message(paste("Global log-likelihood: ", global_optimal_loglikelihood[1:r]))            else if (verbose)                 message(paste("Global log-likelihood: ", global_optimal_loglikelihood[(r -                   n_previous + 1):r]))    }    actual_tol_ll &lt;- abs(ll_optimal - global_optimal_loglikelihood_run)    if (ll_optimal &lt; global_optimal_loglikelihood_run) {        ll_optimal &lt;- global_optimal_loglikelihood_run        optimal_run &lt;- r    }    r &lt;- r + 1}:</span> missing value where TRUE/FALSE needed</span>
<span class="r-in"><span><span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Alessandra Ragni, Giulia Romani, Chiara Masci.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

